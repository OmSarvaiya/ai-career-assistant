<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - AI Interview Assistant</title>
    <meta name="description" content="Manage your account settings, preferences, and profile information.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #2d3748;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        .logo {
            font-size: 26px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #4a5568;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-name {
            font-weight: 500;
            color: #2d3748;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 20px 40px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 40px;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .sidebar h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 8px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: #4a5568;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            gap: 12px;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateX(4px);
        }

        .sidebar-menu .icon {
            font-size: 18px;
        }

        /* Content Area */
        .content-area {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f7fafc;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .section-subtitle {
            color: #718096;
            font-size: 16px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input:disabled {
            background: #f7fafc;
            color: #a0aec0;
            cursor: not-allowed;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Cards */
        .info-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            margin-bottom: 25px;
        }

        .info-card h4 {
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .info-card p {
            color: #4a5568;
            font-size: 14px;
        }

        /* Buttons */
        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Subscription Card */
        .subscription-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .subscription-card h4 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .subscription-card p {
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .btn-white {
            background: white;
            color: #667eea;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-white:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
        }

        /* Success Message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid #c3e6cb;
            margin-bottom: 20px;
            display: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 100px 20px 40px;
            }

            .sidebar {
                position: static;
                order: 2;
            }

            .content-area {
                order: 1;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <a href="/index.html" class="logo">ü§ñ AI Interview Assistant</a>
            <ul class="nav-links">
                <li><a href="/dashboard.html">Dashboard</a></li>
                <li><a href="/pricing.html">Pricing</a></li>
                <li><a href="/index.html#features">Features</a></li>
            </ul>
            <div class="user-info">
                <span class="user-name" id="user-name">Loading...</span>
                <a href="/dashboard.html" class="btn btn-primary">Dashboard</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>Settings</h3>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showSection('profile')">
                    <span class="icon">üë§</span>
                    Profile
                </a></li>
                <li><a href="#" onclick="showSection('account')">
                    <span class="icon">‚öôÔ∏è</span>
                    Account
                </a></li>
                <li><a href="#" onclick="showSection('subscription')">
                    <span class="icon">üí≥</span>
                    Subscription
                </a></li>
                <li><a href="#" onclick="showSection('preferences')">
                    <span class="icon">üîî</span>
                    Preferences
                </a></li>
                <li><a href="#" onclick="showSection('privacy')">
                    <span class="icon">üîí</span>
                    Privacy
                </a></li>
                <li><a href="#" onclick="showSection('support')">
                    <span class="icon">üí¨</span>
                    Support
                </a></li>
            </ul>
        </aside>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Profile Section -->
            <section id="profile" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">Profile Information</h2>
                    <p class="section-subtitle">Update your personal information and profile details</p>
                </div>

                <div class="success-message" id="profile-success">
                    Profile updated successfully!
                </div>

                <form id="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name" class="form-label">First Name</label>
                            <input type="text" id="first-name" name="firstName" class="form-input" placeholder="Enter your first name">
                        </div>
                        <div class="form-group">
                            <label for="last-name" class="form-label">Last Name</label>
                            <input type="text" id="last-name" name="lastName" class="form-input" placeholder="Enter your last name">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="Enter your email">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="job-title" class="form-label">Current Job Title</label>
                            <input type="text" id="job-title" name="jobTitle" class="form-input" placeholder="e.g., Software Engineer">
                        </div>
                        <div class="form-group">
                            <label for="company" class="form-label">Company</label>
                            <input type="text" id="company" name="company" class="form-input" placeholder="Enter your company">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="industry" class="form-label">Industry</label>
                        <select id="industry" name="industry" class="form-input form-select">
                            <option value="">Select your industry</option>
                            <option value="technology">Technology</option>
                            <option value="finance">Finance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="education">Education</option>
                            <option value="marketing">Marketing</option>
                            <option value="sales">Sales</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="bio" class="form-label">Professional Bio</label>
                        <textarea id="bio" name="bio" class="form-input form-textarea" placeholder="Tell us about your professional background..."></textarea>
                    </div>

                    <button type="submit" class="btn-save">Save Changes</button>
                </form>
            </section>

            <!-- Account Section -->
            <section id="account" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Account Settings</h2>
                    <p class="section-subtitle">Manage your account security and login information</p>
                </div>

                <div class="info-card">
                    <h4>Account Information</h4>
                    <p>Your account was created on <strong id="member-since">Loading...</strong></p>
                </div>

                <form id="password-form">
                    <div class="form-group">
                        <label for="current-password" class="form-label">Current Password</label>
                        <input type="password" id="current-password" name="currentPassword" class="form-input" placeholder="Enter current password">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-password" class="form-label">New Password</label>
                            <input type="password" id="new-password" name="newPassword" class="form-input" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password" class="form-label">Confirm Password</label>
                            <input type="password" id="confirm-password" name="confirmPassword" class="form-input" placeholder="Confirm new password">
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Update Password</button>
                </form>

                <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #f7fafc;">
                    <h4 style="color: #e53e3e; margin-bottom: 15px;">Danger Zone</h4>
                    <p style="color: #718096; margin-bottom: 20px;">Once you delete your account, there is no going back. Please be certain.</p>
                    <button class="btn-danger" onclick="confirmDeleteAccount()">Delete Account</button>
                </div>
            </section>

            <!-- Subscription Section -->
            <section id="subscription" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Subscription & Billing</h2>
                    <p class="section-subtitle">Manage your subscription and view usage statistics</p>
                </div>

                <div class="subscription-card">
                    <h4>Current Plan: <span id="current-plan">Loading...</span></h4>
                    <p id="plan-description">Loading subscription details...</p>
                    <button class="btn-white" onclick="openSubscriptionManager()">Manage Subscription</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="usage-count">0</div>
                        <div class="stat-label">AI Responses This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-sessions">0</div>
                        <div class="stat-label">Total Interview Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="success-rate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
            </section>

            <!-- Preferences Section -->
            <section id="preferences" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Preferences</h2>
                    <p class="section-subtitle">Customize your AI interview assistant experience</p>
                </div>

                <form id="preferences-form">
                    <div class="form-group">
                        <label class="form-label">Email Notifications</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="email-notifications" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Receive email notifications about interviews and updates</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Interview Reminders</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="interview-reminders" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Get reminders before scheduled interviews</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="response-speed" class="form-label">AI Response Speed</label>
                        <select id="response-speed" name="responseSpeed" class="form-input form-select">
                            <option value="fast">Fast (1-2 seconds)</option>
                            <option value="balanced" selected>Balanced (2-3 seconds)</option>
                            <option value="detailed">Detailed (3-4 seconds)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="suggestion-style" class="form-label">Suggestion Style</label>
                        <select id="suggestion-style" name="suggestionStyle" class="form-input form-select">
                            <option value="concise">Concise</option>
                            <option value="detailed" selected>Detailed</option>
                            <option value="bullet-points">Bullet Points</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-save">Save Preferences</button>
                </form>
            </section>

            <!-- Privacy Section -->
            <section id="privacy" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Privacy & Data</h2>
                    <p class="section-subtitle">Control how your data is used and stored</p>
                </div>

                <div class="info-card">
                    <h4>Data Protection</h4>
                    <p>We take your privacy seriously. Your interview conversations are processed locally and are never stored on our servers.</p>
                </div>

                <form id="privacy-form">
                    <div class="form-group">
                        <label class="form-label">Usage Analytics</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="usage-analytics" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Allow us to collect anonymous usage data to improve the service</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Marketing Communications</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="marketing-emails">
                                <span class="slider"></span>
                            </label>
                            <span>Receive marketing emails and product updates</span>
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Save Privacy Settings</button>
                </form>

                <div style="margin-top: 40px;">
                    <h4 style="margin-bottom: 15px;">Download Your Data</h4>
                    <p style="color: #718096; margin-bottom: 20px;">Request a copy of all your personal data stored in our system.</p>
                    <button class="btn-secondary" onclick="requestDataExport()">Request Data Export</button>
                </div>
            </section>

            <!-- Support Section -->
            <section id="support" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Help & Support</h2>
                    <p class="section-subtitle">Get help with your account and report issues</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">üìö</div>
                        <div class="stat-label">Knowledge Base</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">üí¨</div>
                        <div class="stat-label">Live Chat</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">üìß</div>
                        <div class="stat-label">Email Support</div>
                    </div>
                </div>

                <form id="support-form">
                    <div class="form-group">
                        <label for="support-subject" class="form-label">Subject</label>
                        <input type="text" id="support-subject" name="subject" class="form-input" placeholder="Brief description of your issue">
                    </div>

                    <div class="form-group">
                        <label for="support-category" class="form-label">Category</label>
                        <select id="support-category" name="category" class="form-input form-select">
                            <option value="">Select a category</option>
                            <option value="technical">Technical Issue</option>
                            <option value="billing">Billing Question</option>
                            <option value="feature">Feature Request</option>
                            <option value="bug">Bug Report</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="support-message" class="form-label">Message</label>
                        <textarea id="support-message" name="message" class="form-input form-textarea" placeholder="Describe your issue or question in detail..."></textarea>
                    </div>

                    <button type="submit" class="btn-save">Send Message</button>
                </form>
            </section>
        </main>
    </div>

    <script>
     const API_BASE = 'https://ai-career-assistant-production.up.railway.app/api';
        let currentUser = null;

        // Initialize settings page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            loadSubscriptionInfo();
        });

        // Load user data
        async function loadUserData() {
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                window.location.href = '/auth.html';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    populateUserData(data.user);
                } else {
                    localStorage.removeItem('authToken');
                    window.location.href = '/auth.html';
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Populate user data in forms
        function populateUserData(user) {
            document.getElementById('user-name').textContent = user.name;
            
            // Split name into first and last name
            const nameParts = user.name.split(' ');
            document.getElementById('first-name').value = nameParts[0] || '';
            document.getElementById('last-name').value = nameParts.slice(1).join(' ') || '';
            
            document.getElementById('email').value = user.email || '';
            document.getElementById('member-since').textContent = new Date(user.createdAt).toLocaleDateString();
        }

        // Load subscription information
        async function loadSubscriptionInfo() {
            const userId = getCurrentUserId();
            if (!userId) return;

            try {
                const response = await fetch(`${API_BASE}/subscription/manage/${userId}`);
                const data = await response.json();

                if (data.success) {
                    updateSubscriptionDisplay(data.data);
                }
            } catch (error) {
                console.error('Error loading subscription info:', error);
            }
        }

        // Update subscription display
        function updateSubscriptionDisplay(subscriptionData) {
            const { subscription, usage } = subscriptionData;
            
            document.getElementById('current-plan').textContent = subscription.planName;
            document.getElementById('plan-description').textContent = `Your ${subscription.planName} is ${subscription.status}`;
            document.getElementById('usage-count').textContent = usage.responses || 0;
            document.getElementById('total-sessions').textContent = Math.floor(Math.random() * 50) + 10; // Mock data
            document.getElementById('success-rate').textContent = '87%'; // Mock data
        }

        // Get current user ID
        function getCurrentUserId() {
            const userData = localStorage.getItem('userData');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    return user.id || user._id;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            const token = localStorage.getItem('authToken');
            if (token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    return payload.userId || payload.sub || payload.id;
                } catch (e) {
                    console.error('Error decoding token:', e);
                }
            }
            
            return '507f1f77bcf86cd799439011'; // Fallback
        }

        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked menu item
            event.target.classList.add('active');
        }

        // Form submissions - Updated to use real APIs
        document.getElementById('profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const profileData = Object.fromEntries(formData);
            const userId = getCurrentUserId();
            
            try {
                const response = await fetch(`${API_BASE}/user/profile/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(profileData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showSuccessMessage('profile-success');
                    console.log('Profile updated:', result);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Error updating profile. Please try again.');
            }
        });

        document.getElementById('password-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const passwordData = Object.fromEntries(formData);
            const userId = getCurrentUserId();
            
            if (passwordData.newPassword !== passwordData.confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/user/password/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        currentPassword: passwordData.currentPassword,
                        newPassword: passwordData.newPassword
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Password updated successfully');
                    this.reset();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating password:', error);
                alert('Error updating password. Please try again.');
            }
        });

        document.getElementById('preferences-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const preferencesData = Object.fromEntries(formData);
            const userId = getCurrentUserId();
            
            // Add checkbox values
            preferencesData.emailNotifications = document.getElementById('email-notifications').checked;
            preferencesData.interviewReminders = document.getElementById('interview-reminders').checked;
            
            try {
                const response = await fetch(`${API_BASE}/user/preferences/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(preferencesData)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Preferences saved successfully');
                    console.log('Preferences updated:', result);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating preferences:', error);
                alert('Error updating preferences. Please try again.');
            }
        });

        document.getElementById('privacy-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const privacyData = {
                usageAnalytics: document.getElementById('usage-analytics').checked,
                marketingEmails: document.getElementById('marketing-emails').checked
            };
            const userId = getCurrentUserId();
            
            try {
                const response = await fetch(`${API_BASE}/user/privacy/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(privacyData)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Privacy settings saved successfully');
                    console.log('Privacy settings updated:', result);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error updating privacy settings:', error);
                alert('Error updating privacy settings. Please try again.');
            }
        });

        document.getElementById('support-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const supportData = Object.fromEntries(formData);
            const userId = getCurrentUserId();
            supportData.userId = userId;
            
            try {
                const response = await fetch(`${API_BASE}/user/support`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(supportData)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Support ticket submitted successfully. We\'ll get back to you soon!');
                    this.reset();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error submitting support ticket:', error);
                alert('Error submitting support ticket. Please try again.');
            }
        });

        // Utility functions
        function showSuccessMessage(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function openSubscriptionManager() {
            const userId = getCurrentUserId();
            const subscriptionUrl = `${window.location.origin}/subscription.html?userId=${userId}`;
            window.open(subscriptionUrl, '_blank');
        }

        function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                    deleteAccount();
                }
            }
        }

        async function deleteAccount() {
            try {
                // Mock API call - replace with actual endpoint
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                alert('Account deleted successfully');
                localStorage.clear();
                window.location.href = '/index.html';
            } catch (error) {
                console.error('Error deleting account:', error);
                alert('Error deleting account. Please contact support.');
            }
        }

        function requestDataExport() {
            alert('Data export request submitted. You will receive an email with your data within 24 hours.');
        }

        // Handle clicks outside of forms to prevent accidental navigation
        document.addEventListener('click', function(e) {
            if (e.target.matches('.sidebar-menu a')) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
